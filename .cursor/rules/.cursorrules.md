# .cursorrules — STRICT OPERATING RULES FOR CURSOR AI

# ROLE: I am an AI engineer. I deliver COMPLETE, VERIFIABLE, PRODUCTION-READY code

# I NEVER claim "done" without proof. I NEVER use placeholders. I NEVER approximate

################################################################################

# SECTION 0: ABSOLUTE PROHIBITIONS (INSTANT STOP)

################################################################################

- **NEVER EDIT MAIN DIRECTLY** → If on `main`: STOP. Create branch: `{feat|fix|refactor|chore}/{kebab-case}`
- **NEVER USE PLACEHOLDERS** → No `TODO`, `FIXME`, `...`, `pass`, `NotImplementedError`, `<your-value-here>`
- **NEVER HARDCODE SCIENTIFIC VALUES** → No magic numbers. All constants from config/args with units+source
- **NEVER SKIP VERIFICATION** → No claiming completion without showing green CI output
- **NEVER USE --no-verify** → Pre-commit hooks are law
- **NEVER TRUNCATE FILES** → Preserve all code. Use targeted edits only
- **NEVER APPROXIMATE** → In scientific computing, exact values only. If unknown, STOP and ask
- **NEVER USE "approximately"** → If tempted to write "approximately", START OVER with exact solution

################################################################################

# MANDATORY REQUIREMENTS FOR EVERY RESPONSE

################################################################################

1. **SHOW EXACT COMMANDS AND FULL OUTPUT** (not summaries):

   ```bash
   $ ruff check .
   All checks passed!

   $ mypy . --strict
   Success: no issues found in 25 source files

   $ pytest -xvs
   test_module.py::test_function PASSED
   test_module.py::test_edge_case PASSED
   ================== 2 passed in 0.34s ==================
   ```

2. **INCLUDE NEGATIVE TESTS** for every function:

   ```python
   def test_calculate_trajectory_invalid():
       """Test what happens with bad input."""
       with pytest.raises(ValueError, match="Mass must be positive"):
           calculate_trajectory(mass_kg=-1.0)
       with pytest.raises(ValueError, match="Angle must be between"):
           calculate_trajectory(angle_deg=361.0)
   ```

3. **EXPLAIN EVERY NUMBER WITH SOURCE**:

   ```python
   # BAD: NEVER DO THIS
   velocity = distance * 3.6  # NO!

   # GOOD: ALWAYS DO THIS
   MPS_TO_KPH: Final[float] = 3.6  # [m/s → km/h] conversion: (1000m/1km)/(3600s/1h)
   velocity_kph = velocity_mps * MPS_TO_KPH
   ```

4. **IF YOU WRITE "approximately" or use placeholder, START OVER**

################################################################################

# SECTION 1: REPOSITORY CONTEXT (READ FIRST)

################################################################################
MUST READ before ANY edit:

- `.pre-commit-config.yaml` → ruff/black/mypy/nbstripout hooks + quality-check
- `ruff.toml` → lint rules & exclusions
- `mypy.ini` → type checking rules
- `.github/workflows/ci.yml` → Required check: **lint-and-test**
- `.gitattributes` → LFS for `.slx/.mdl/.mat/.h5`
- `scripts/quality-check.py` → Enforces no placeholders/magic numbers
- Folder structure:

  ```
  /python/<project>/       # Python packages
  /matlab/<project>/       # MATLAB modules
  /scripts/                # Entry points only
  /docs/                   # All documentation
  /data/                   # Small fixtures (big data → LFS)
  /tests/                  # All tests here
  ```

################################################################################

# SECTION 2: PROJECT ORGANIZATION STANDARDS

################################################################################

## **MANDATORY Folder Organization Requirements**

- **Main Directories**: Keep clean with only essential files (max 10 files)
  - Main application files
  - Project README.md files
  - Configuration files
  - Essential data files
- **Functions Directories**: `functions/` folder for all extracted modules
  - Group functions by responsibility (core, GUI, data processing, etc.)
  - One function per file (filename == function name)
  - Organize related functions in logical subdirectories if needed
- **Documentation Directories**: `docs/` folder for all documentation
  - README files, guides, and analysis documents
  - Technical documentation and progress tracking
  - Performance analysis and optimization guides
  - User documentation and tutorials
- **Test Directories**: `tests/` folder for unit tests and validation scripts
  - Unit tests for individual functions
  - Integration tests for modules
  - Performance benchmarks
- **Data Directories**: `data/` folder for input/output data files
  - Input datasets and configuration files
  - Output results and generated data
  - Temporary files and caches

## **Project Structure Template**

```
ProjectName/
├── main.py                    # Main application entry point
├── README.md                  # Project overview and navigation
├── functions/                 # All function modules
│   ├── core/                  # Core functionality modules
│   ├── gui/                   # GUI-related functions
│   ├── data/                  # Data processing functions
│   ├── utils/                 # Utility functions
│   └── tests/                 # Test functions
├── docs/                      # Documentation
│   ├── user_guides/           # User documentation
│   ├── technical/             # Technical documentation
│   ├── progress/              # Progress tracking
│   └── performance/           # Performance analysis
├── tests/                     # Unit and integration tests
├── data/                      # Data files
│   ├── input/                 # Input data
│   ├── output/                # Output results
│   └── temp/                  # Temporary files
├── config/                    # Configuration files
└── archive/                   # Backup and archive files
```

## **Folder Organization Rules**

- **MUST** separate functions from documentation
- **MUST** keep main directory clean and focused
- **SHOULD** group related functions in subdirectories
- **SHOULD** use descriptive folder names
- **AVOID** mixing code, docs, and data in same directory
- **AVOID** having more than 10 files in main directory

## **Documentation Requirements**

- **MUST** store all documentation in `docs/` folder
- **MUST** organize documentation by purpose (user guides, technical, progress)
- **MUST** keep README.md files updated and comprehensive
- **SHOULD** include progress tracking and performance analysis docs
- **SHOULD** document all constants with sources and units

################################################################################

# SECTION 3: WORKFLOW FOR EVERY CHANGE

################################################################################

## A) BRANCH FIRST

```bash
git checkout -b {type}/{description}
# For AI changes >50 lines: ALSO create backup
git checkout -b backup/before-ai-$(date +%Y%m%d)
```

## B) PLAN (PRINT BEFORE EDITING)

```
TASK: [one sentence]
FILES: [exact paths + why each]
DEPENDENCIES: [import graph]
DOD: □ ruff □ mypy □ pre-commit □ pytest □ quality-check □ CI green □ no placeholders
STRATEGY: [atomic(<300 lines) OR stacked PRs]
```

## C) EXECUTE IN ORDER

1. **MECHANICAL** → `ruff check --fix`, imports, f-strings
2. **TYPING** → Add annotations to satisfy mypy --strict
3. **LOGIC** → Bug fixes WITH tests (including negative tests)
4. **VERIFY** → Run these and PASTE FULL output:

   ```bash
   python scripts/quality-check.py
   ruff check . --select ALL
   mypy . --strict
   pre-commit run --all-files
   pytest -xvs --cov=. --cov-report=term-missing
   ```

## D) OUTPUT REQUIREMENTS

- Unified diffs or exact line replacements
- Traceability: requirement → file:line → test:line
- Test output showing ALL tests PASS
- Coverage report showing new code covered
- README snippet demonstrating usage

################################################################################

# SECTION 3: PYTHON TECHNICAL REQUIREMENTS

################################################################################

```python
# REQUIRED for scientific computing:
import logging
from pathlib import Path
from typing import Final, Literal, TypeAlias
import numpy as np

# Constants MUST be explicit with citations
GRAVITY_M_S2: Final[float] = 9.80665  # [m/s²] Standard gravity per ISO 80000-3:2006
GOLF_BALL_MASS_KG: Final[float] = 0.04593  # [kg] USGA Rule 5-1 (1.620 oz)
AIR_DENSITY_KG_M3: Final[float] = 1.225  # [kg/m³] at sea level, 15°C, per ISA
RNG_SEED: Final[int] = 42  # Reproducibility seed

# Set determinism ALWAYS (no exceptions)
np.random.seed(RNG_SEED)
random.seed(RNG_SEED)
if 'torch' in sys.modules:
    import torch
    torch.manual_seed(RNG_SEED)
    torch.cuda.manual_seed_all(RNG_SEED)

# Logging required (no print in libraries)
logger = logging.getLogger(__name__)

# Path handling with validation
data_path = Path("data") / "input.csv"
if not data_path.exists():
    raise FileNotFoundError(f"Required file missing: {data_path.absolute()}")

# Type everything, no exceptions
def calculate_trajectory(
    initial_velocity_mps: float,  # [m/s] Note: not "velocity", be specific
    launch_angle_deg: float,       # [degrees] from horizontal
    spin_rate_rpm: float,          # [rpm] backspin positive
    timestep_s: float = 0.001      # [s] integration timestep
) -> tuple[np.ndarray, dict[str, float]]:
    """Calculate ballistic trajectory with Magnus effect.

    Args:
        initial_velocity_mps: Initial ball velocity [m/s]
        launch_angle_deg: Launch angle from horizontal [degrees]
        spin_rate_rpm: Backspin rate [rpm], positive = backspin
        timestep_s: Integration timestep [s]

    Returns:
        positions: Shape (n_steps, 3) array of [x, y, z] positions [m]
        metadata: Dict with 'max_height_m', 'range_m', 'flight_time_s'

    Raises:
        ValueError: If velocity < 0 or angle not in [0, 90]
    """
    # Input validation with clear error messages
    if initial_velocity_mps < 0:
        raise ValueError(f"Velocity must be non-negative, got {initial_velocity_mps} m/s")
    if not 0 <= launch_angle_deg <= 90:
        raise ValueError(f"Launch angle must be in [0, 90], got {launch_angle_deg}°")

    # Implementation with full physics...

# Tests immediately follow implementation
def test_calculate_trajectory_valid():
    """Test trajectory with typical driver shot."""
    pos, meta = calculate_trajectory(70.0, 12.0, 2500.0)
    assert pos.shape[1] == 3
    assert meta['max_height_m'] > 0
    assert meta['range_m'] > 0

def test_calculate_trajectory_invalid():
    """Test error handling for invalid inputs."""
    with pytest.raises(ValueError, match="Velocity must be non-negative"):
        calculate_trajectory(-1.0, 45.0, 0.0)
    with pytest.raises(ValueError, match="Launch angle must be"):
        calculate_trajectory(50.0, -10.0, 0.0)
```

################################################################################

# SECTION 4: MATLAB TECHNICAL REQUIREMENTS

################################################################################

```matlab
% REQUIRED structure with full validation:
function results = process_swing_data(input_file, options)
    % PROCESS_SWING_DATA Analyze golf swing with reproducibility
    %
    % Inputs:
    %   input_file - Path to data file (must exist)
    %   options    - Struct with fields:
    %                .seed (default: 42) - RNG seed
    %                .tolerance (default: 1e-6) - Numerical tolerance
    %                .max_iter (default: 1000) - Max iterations
    %
    % Outputs:
    %   results    - Struct with fields:
    %                .data - Processed data array
    %                .metadata - Processing metadata struct
    %                .timestamp - ISO 8601 timestamp

    arguments
        input_file (1,1) string {mustBeFile}
        options.seed (1,1) double {mustBePositive} = 42
        options.tolerance (1,1) double {mustBePositive} = 1e-6
        options.max_iter (1,1) double {mustBeInteger, mustBePositive} = 1000
    end

    % Set reproducibility
    rng(options.seed, 'twister');

    % Validate inputs
    assert(exist(input_file, 'file') == 2, ...
           'PROCESS_SWING_DATA:FileNotFound', ...
           'Input file not found: %s', input_file);

    % Store metadata
    results.metadata.matlab_version = version;
    results.metadata.timestamp = datetime('now', 'Format', 'yyyy-MM-dd''T''HH:mm:ss');
    results.metadata.git_sha = get_git_sha();
    results.metadata.input_file = char(input_file);
    results.metadata.options = options;

    % Process with comprehensive error handling
    try
        raw_data = readmatrix(input_file);

        % Validate data
        if any(isnan(raw_data(:)))
            warning('PROCESS_SWING_DATA:NaNDetected', ...
                    'NaN values found in input data');
        end

        % Process...
        results.data = raw_data;  % Actual processing here

    catch ME
        fprintf('Error in %s at line %d: %s\n', ...
                ME.stack(1).name, ME.stack(1).line, ME.message);
        results.metadata.error = ME.message;
        rethrow(ME);
    end
end

function sha = get_git_sha()
    % Get current git commit SHA
    [status, sha] = system('git rev-parse HEAD');
    if status == 0
        sha = strtrim(sha);
    else
        sha = 'unknown';
    end
end
```

################################################################################

# SECTION 5: PROOF REQUIREMENTS (NO EXCEPTIONS)

################################################################################
Before claiming ANY task complete, provide ALL of:

1. **Quality check output**:

   ```
   $ python scripts/quality-check.py
   ✅ Quality check PASSED
   Checked 25 Python files
   ```

2. **Linting output (FULL, not summary)**:

   ```
   $ ruff check .
   All checks passed!

   $ mypy . --strict
   Success: no issues found in 25 source files
   ```

3. **Pre-commit output (FULL)**:

   ```
   $ pre-commit run --all-files
   black............................Passed
   isort............................Passed
   ruff.............................Passed
   mypy.............................Passed
   nbstripout.......................Passed
   quality-check....................Passed
   ```

4. **Test output with coverage**:

   ```
   $ pytest -xvs --cov=python --cov-report=term-missing
   test_calc.py::test_trajectory_valid PASSED
   test_calc.py::test_trajectory_invalid PASSED
   test_calc.py::test_trajectory_edge_cases PASSED

   ---------- coverage report ----------
   Name                      Stmts   Miss  Cover   Missing
   -------------------------------------------------------
   python/calc.py               45      0   100%
   python/test_calc.py          23      0   100%
   -------------------------------------------------------
   TOTAL                        68      0   100%

   ================== 3 passed in 1.24s ==================
   ```

5. **Git status showing branch**:

   ```
   $ git status
   On branch feat/trajectory-calculator
   Your branch is up to date with 'origin/feat/trajectory-calculator'
   ```

################################################################################

# SECTION 6: BLOCKED PROTOCOL

################################################################################
If task exceeds constraints OR would require approximation/placeholder:

```
STATUS: BLOCKED
REASON: [specific blocker, e.g., "Unknown constant needed: club shaft stiffness"]
COMPLETED:
  ✅ Input validation implemented
  ✅ Basic trajectory calculation
  ✅ Tests for known cases
REMAINING:
  ❌ Magnus effect calculation (needs spin decay model)
  ❌ Air density variation with altitude
PLAN:
  PR-1: Basic trajectory without spin (~200 lines)
  PR-2: Add Magnus effect with cited coefficients (~150 lines)
  PR-3: Add atmospheric model (~100 lines)
UNBLOCK: Need source for spin decay rate vs velocity
```

################################################################################

# SECTION 7: PR REQUIREMENTS

################################################################################

## Commit Message (Conventional Commits)

```
<type>(<scope>): <subject>

<body explaining WHY not what>
<body must explain every constant's source>

Refs: #<issue>
```

## PR Body MUST Include

```markdown
## Changes
- [ ] No behavior change (refactor only)
- [ ] Bug fix (with test proving the bug and fix)
- [ ] New feature (with test + docs)

## Verification (PASTE ACTUAL OUTPUT)
```bash
$ python scripts/quality-check.py
✅ Quality check PASSED

$ ruff check .
All checks passed!

$ mypy . --strict
Success: no issues found

$ pytest -xvs
... [FULL OUTPUT]
```

## Traceability

| Requirement | Implementation | Test | Coverage |
|-------------|---------------|------|----------|
| Handle negative mass | calc.py:45-47 | test_calc.py:89-92 | 100% |
| Validate launch angle | calc.py:49-51 | test_calc.py:94-97 | 100% |

## Constants Documentation

| Constant | Value | Units | Source |
|----------|-------|-------|--------|
| GRAVITY_M_S2 | 9.80665 | m/s² | ISO 80000-3:2006 |
| AIR_DENSITY_KG_M3 | 1.225 | kg/m³ | ISA at sea level, 15°C |

## No Placeholders Certification

- [X] Zero TODO/FIXME/pass in diff
- [X] All paths have error handling
- [X] All constants have citations
- [X] No "approximately" in code or comments

```

################################################################################
# SECTION 8: EXAMPLES
################################################################################
## GOOD (will accept):
```python
# Clear source, units, validation, tests
SHAFT_LENGTH_M: Final[float] = 1.1684  # [m] USGA Rule 1-1c limit (46 inches)
SHAFT_MASS_KG: Final[float] = 0.062  # [kg] Typical graphite driver shaft per Fujikura specs

def calculate_moment_of_inertia(mass_kg: float, length_m: float) -> float:
    """Calculate MOI for uniform rod about end.

    Formula: I = (1/3) * m * L²
    Source: Halliday, Resnick, Walker - Fundamentals of Physics, 10th Ed, Table 10-2
    """
    if mass_kg <= 0:
        raise ValueError(f"Mass must be positive, got {mass_kg} kg")
    if length_m <= 0:
        raise ValueError(f"Length must be positive, got {length_m} m")

    return mass_kg * length_m**2 / 3.0  # [kg⋅m²]

def test_calculate_moment_of_inertia():
    """Test MOI calculation with known values."""
    # Test with 1 kg, 1 m rod
    assert calculate_moment_of_inertia(1.0, 1.0) == pytest.approx(0.3333, rel=1e-4)

def test_calculate_moment_of_inertia_invalid():
    """Test error handling."""
    with pytest.raises(ValueError, match="Mass must be positive"):
        calculate_moment_of_inertia(-1.0, 1.0)
```

## BAD (will reject)

```python
# ALL OF THIS IS UNACCEPTABLE
def calculate_moment(mass, length):
    # TODO: implement this properly
    return mass * length * 0.33  # approximately 1/3

GRAVITY = 9.8  # close enough

angle = 45  # degrees probably?

def process():
    pass  # Will implement later
```

################################################################################

# DAILY WORKFLOW

################################################################################
START: `git checkout -b feat/today-$(date +%Y%m%d)`
EVERY 30 MIN: `git commit -m "wip: <specific progress>"`
BEFORE MAJOR CHANGES: `git checkout -b backup/before-<change>`
END OF DAY: `bash scripts/snapshot.sh` → creates safety tag+branch
TOMORROW: New branch from main, cherry-pick if needed

# END — I WILL FOLLOW THESE RULES WITHOUT EXCEPTION. IF I CANNOT MEET THEM, I WILL STOP AND EXPLAIN EXACTLY WHY

################################################################################

################################################################################

# SECTION 8: TERMINAL OPERATIONS AND STALL PREVENTION

################################################################################

### **MANDATORY Stall Prevention Guidelines**

To prevent terminal stalls and improve command execution reliability, follow these **MANDATORY** practices:

#### **Command Execution Rules**

- **NEVER** chain multiple complex operations in a single command
- **NEVER** use relative paths when absolute paths are more reliable
- **ALWAYS** execute one operation at a time
- **ALWAYS** verify terminal state between operations
- **ALWAYS** use explicit path specifications

#### **Simple Command Stall Prevention**

**NEW**: Simple commands can also stall due to terminal state confusion:

- **ALWAYS** verify you're in the correct directory before running any command
- **ALWAYS** check if you're in a Git repository before running Git commands
- **NEVER** run Git commands from outside a Git repository context
- **ALWAYS** use `pwd` to confirm current location before any operation

#### **Git Ignored Files Stall Prevention**

**CRITICAL**: Git operations on ignored files can cause stalls:

- **NEVER** run Git operations on files in `.gitignore` directories (like `.cursor/`)
- **ALWAYS** check `.gitignore` before attempting Git operations
- **USE** `git add -f` sparingly and only when absolutely necessary
- **PREFER** moving files to tracked locations over force-adding ignored files

#### **Post-Operation Terminal State Verification**

**MANDATORY**: After any Git operation, verify terminal state:

- **ALWAYS** run `pwd` after Git operations to confirm location
- **ALWAYS** run `git status` to verify repository state
- **ALWAYS** check if shell is responsive with simple commands
- **NEVER** assume terminal state is stable after Git operations

#### **Terminal State Recovery**

If simple commands start stalling:

1. **Check Current Context**: `pwd` to verify location
2. **Verify Git Status**: `git rev-parse --git-dir` to check if in Git repo
3. **Clear Terminal State**: `clear` or `reset` if needed
4. **Restart Terminal**: If stalls persist, open a new terminal
5. **Navigate Fresh**: Start from a known good directory

#### **Git Operations Best Practices**

- **MUST** check current directory before Git commands (`pwd`)
- **MUST** verify Git status before operations (`git status`)
- **MUST** use absolute paths for repository navigation
- **MUST** create branches from repository root directories
- **MUST** avoid complex chained Git operations

#### **Repository-Specific Navigation**

- **Project_Template**: Always navigate to `/c/Users/diete/Repositories/Project_Template`
- **Tools**: Always navigate to `/c/Users/diete/Repositories/Tools`
- **MLProjects**: Always navigate to `/c/Users/diete/Repositories/MLProjects`
- **Robotics**: Always navigate to `/c/Users/diete/Repositories/Robotics`
- **Git_Gud**: Always navigate to `/c/Users/diete/Repositories/Git_Gud`
- **Golf_Model**: Always navigate to `/c/Users/diete/Repositories/Golf_Model`

#### **Stall Prevention Checklist**

Before executing any terminal operation:

- [ ] Current directory is known and verified
- [ ] Target paths are absolute when possible
- [ ] Git repository status is checked
- [ ] Operation is broken into single steps
- [ ] Exit codes are verified after each step
- [ ] Terminal state is confirmed between operations
- [ ] `.gitignore` is checked for target files
- [ ] Post-operation verification plan is ready

#### **Shell Restart Recovery Protocol**

**WHEN**: Shell restarts unexpectedly after Git operations:

1. **Check Current Location**: `pwd` to see where you are
2. **Verify Repository**: `git rev-parse --git-dir` to confirm Git context
3. **Check Git Status**: `git status` to see repository state
4. **Verify Last Operation**: Check if the last Git command succeeded
5. **Continue Safely**: Resume operations with enhanced stall prevention
6. **Document Issue**: Note what caused the shell restart for future prevention

################################################################################

# SECTION 9: GLOBAL WORKSPACE REFERENCES

################################################################################

# These rules are specific to this repository's scientific computing standards

# For global workspace rules and stall prevention guidelines, see

# - [Global Cursor Rules](../../.cursorrules.md)

# - [Stall Prevention Guide](../../docs/STALL_PREVENTION_GUIDE.md)

# - [Requirements File Standards](../../docs/REQUIREMENTS_FILE_STANDARDS.md)
